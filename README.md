# Проект Test_lib

Это REST API сервис для управления библиотекой с возможностью регистрации пользователей, добавления и выдачи книг. Проект реализован на Python с использованием FastAPI, PostgreSQL и SQLAlchemy.

Стек:
*FastAPI*
*PostgreSQL*
*SQLAlchemy*
*Alembic*
*Pydantic*

## Установка
1. Клонируйте репозиторий
```
git clone https://github.com/AntonNovozhilov/test_lib.git
cd test_lib
```
2. Установите зависимости
```
pip install -r requirements.txt 
```
3. Создайте базу данных PostgreSQL и настройте переменные окружения в .env файле:
```
DB_USER=
DB_PASSWORD=
DB_HOST=
DB_PORT=
DB_NAME=
DB_DRIVER=
```
4. Установите секретный ключ для настройки авторизции.
В файле .env
```
SECRET_KEY=
```
[Подробнее в документации](https://fastapi.tiangolo.com/ru/tutorial/security/oauth2-jwt/)
5. Выполните миграции базы данных
```
alembic upgrade head
```
6. Запустите сервер 
```
uvicorn app.main:app --reload
```

## Регистрация первого пользователя

Первый пользователь создается через эндпоинт регистрации /register. В теле запроса необходимо передать username(он же email) и password. После регистрации вы получите JWT токен для аутентификации.

Пример запроса:

json
POST /register
{
  "username": "test@test.ru",
  "password": "test"
}

## Структура проекта

В проекте реализована модульная архитектура для удобства поддержки и масштабирования:

Модели базы данных (SQLAlchemy) расположены в отдельных модулях по функциональным областям. Каждая модель или группа связанных моделей находится в своей папке, что облегчает навигацию и изоляцию ответственности. Это позволяет развивать каждую бизнес-область независимо и упрощает рефакторинг.

Pydantic-схемы (валидация и сериализация данных) также организованы по отдельным папкам, сгруппированы по назначению и по группам API. Такая структура повышает читаемость и разделяет ответственность между слоями данных и логики.

Роутеры и контроллеры для API разделены по функциональным группам, каждая группа эндпоинтов находится в отдельной папке. Это упрощает масштабирование приложения, добавление новых функциональных блоков и совместную работу нескольких разработчиков.

*app/main.py* — точка входа, инициализация FastAPI приложения

*api/* — папка с роутерами для разных ресурсов (пользователи, книги и т.д.)

*models.py/* — модели базы данных с помощью SQLAlchemy

*schemas.py/* — Pydantic модели для валидации данных

## Аутентификация

Проект построен на идеи, что управлять сущностями могут только авторизованные пользователи изначально, поэтому доступ к каждой ручке защищен по jwt токену. 

Используемые библиотеки
python-jose — для создания и валидации JWT-токенов.
passlib[bcrypt] — для безопасного хеширования и проверки паролей.
fastapi.security.HTTPBearer — встроенный механизм FastAPI для извлечения токенов из заголовка авторизации.
python-dotenv — для загрузки секретных переменных из .env.
